# Simple smoke test: flat-object field mapping type can be sent to cluster and simple document can be indexed.

---
setup:
  - do:
      indices.create:
        index: test
        body:
          mappings:
            dynamic: strict
            properties:
              ISBN13:
                type : "keyword"
              catalog:
                type : "flat-object"

---
teardown:
  - do:
      indices.delete:
        index: test

---
"Flat object test":
  - do:
      index:
        index: test
        id:    1
        body:  {
          "ISBN13": "V9781933988177",
          "catalog": {
            "title": "Lucene in Action",
            "author":
            {
              "surname": "McCandless",
              "given": "Mike"
            }
          }
        }

  # Do index refresh
  - do:
      indices.refresh:
        index: test

  - do:
      search:
        body: {
          _source: true,
          query: {
            match: { catalog: "Lucene in Action"}
          }
        }

  - length:   { hits.hits: 1  }
  - match: { hits.hits.0._source.catalog.title: "Lucene in Action" }
